<template name="devBody">
  {{> coverPhoto }}
  <div class="container">
    {{> alerts where="main"}}
    {{#if SEql 'searching' 'not'}}
      {{> setLocation}}
      {{> listHeader}}
      {{> listOfGames}}
    {{else}}
      {{#if SEql 'searching' 'after'}}
        {{> findingsMap}}
        <!-- {{> subscribe}} -->
        {{> searchQuery}}
        {{> listOfGames}}
      {{else}}
        {{#if SGet 'search-results'}}
          {{> findingsMap}}
          <!-- {{> subscribe}} -->
          {{> searchQuery}}
          {{> listOfGames}}
        {{else}}
          {{> listOfGames}}
        {{/if}}
      {{/if}}
    {{/if}}
  </div>
</template>

<template name="coverPhoto">
  <div class="cover-photo-container">
    <img src="/img/streetbasketball.jpg" class="cover-photo">
  </div>
  {{#if SEql 'searching' 'not'}}
  <div class="headline-container">
    <div class="container">
      <h1 class="headline-primary">Welcome to PushPickup.</h1>
      <p>Better than email for organizing pickup basketball, soccer, and ultimate.</p>
    </div>
  </div>
  {{/if}}
</template>

<template name="whoIsPlaying">
  <div class="who-is-playing">
    {{#if organizing}}
      <strong class="text-{{#if past startsAt}}muted{{else}}info{{/if}}">
        {{participle startsAt past='Organized' present='Organizing'}}
      </strong>
        {{#unless past startsAt}}
          + {{numNeeded}} needed
        {{else}}
          for {{numOthers}} others
        {{/unless}}
    {{else}}
      {{#if playing}}
        <strong class="text-{{#if past startsAt}}muted{{else}}info{{/if}}">
          {{participle startsAt past='Played' present='Playing'}}
        </strong>
        {{#unless past startsAt}}
          + {{numNeeded}} needed
        {{else}}
          with {{numOthers}} others
        {{/unless}}
      {{else}}
        {{players.length}}
        {{participle startsAt past='played' present='playing'}}
        {{#unless past startsAt}}({{numNeeded}} needed){{/unless}}
      {{/if}}
    {{/if}}
  </div>
</template>

<template name="joinGameLink">
  <div class="join-game-link">
    <a class="{{#if SEql 'unauth-join' _id}}text-muted{{/if}}">Join</a>
  </div>
</template>

<template name="addFriendsLink">
  <div class="add-friends-link">
    <a><span class="ppicon-add-friend"></span></a>
  </div>
</template>

<template name="addInfoOrSignIn">
  <p class="add-info-or-sign-in form-heading">
    {{#unless SGet 'sign-in'}}
      Add your info or <a class="sign-in">sign in</a>
    {{else}}
      Sign in or <a class="add-info">add your info</a>
    {{/unless}}
    to {{action}}.
  </p>
  <div class="tight form-group">
    <input type="email" class="form-control email"
           placeholder="Your email" value="{{email}}" required autofocus>
    {{#unless SGet 'sign-in'}}
      <input type="text" class="form-control full-name"
             placeholder="Your full name" required>
    {{else}}
      <input type="password" class="form-control password"
             placeholder="Your password" required>
    {{/unless}}
  </div>
</template>

<template name="addPlayers">
  <div class="add-players">
    {{#if SEql 'unauth-join' _id}}
      {{> addSelfAndFriends}}
    {{/if}}
    <!-- 'unauth-join' and 'add-friends' should never both be non-null
         because 'add-friends' is for authenticated users. -->
    {{#if SEql 'invite-friends' _id}}
      {{> inviteFriends}}
    {{/if}}
  </div>
</template>

<template name="addSelfAndFriends">
  <div class="add-self-and-friends well">
    <button type="button" class="close" aria-hidden="true">&times;</button>
    <form class="add-self-and-friends" role="form">
      {{#unless currentUser}}
        {{> addInfoOrSignIn action="join"}}
      {{/unless}}
      {{> alerts where="addSelfAndFriends"}}
      <button type="submit" class="btn join-game">Join Game</button>
    </form>
  </div>
</template>

<template name="inviteFriends">
  <div class="add-friends well">
    <button type="button" class="close" aria-hidden="true">&times;</button>
    <form class="add-friends" role="form">
      {{> inviteFriendsInput}}
      {{> alerts where="addjoinFriends"}}
      <button type="submit" class="btn join-game"> Invite {{pluralize numFriends "friend" "friends"}}</button>
    </form>
  </div>
</template>

<template name="unauthInviteFriends">
  {{#if SEql 'unauth-invite-friends' _id}}
    {{> inviteFriendsInput}}
  {{else}}
    {{> unauthInviteFriendsLink}}
  {{/if}}
</template>

<template name="unauthInviteFriendsLink">
  <div class="form-group">
    <p class="form-control-static">
      <a class="unauth-invite-friends-link">
        <span class="glyphicon glyphicon-plus-sign"></span>
        Invite friend</a>
    </p>
  </div>
</template>

<template name="inviteFriendsInput">
  {{#each friends}}
    <p class="form-heading">Invite friends</p>
    <div class="tight form-group">
      <input type="text" class="form-control friend-name"
             placeholder="Friend's name"
             value="{{name}}" id="{{_id}}"
             required autofocus>
      <input type="email" class="form-control friend-email"
             placeholder="Friend's email"
             value="{{email}}" id="{{_id}}">
    </div>
  {{/each}}
  <div class="form-group">
    <p class="form-control-static">
      <a class="add-another-friend">
        <span class="glyphicon glyphicon-plus-sign"></span>
        Add friend to invite</a>
    </p>
  </div>
</template>

<template name="getCurrentLocation">
  <button class="btn btn-header-secondary get-current-location" type="button">
    {{#unless SGet 'get-user-location'}}
      <i class="fa fa-location-arrow"></i>
    {{/unless}}
    {{#if SEql 'get-user-location' 'pending'}}
      <i class="fa fa-refresh fa-spin"></i>
    {{/if}}
    {{#if SEql 'get-user-location' 'success'}}
      <i class="fa fa-check-circle"></i>
    {{/if}}
    {{#if SEql 'get-user-location' 'failure'}}
      <i class="fa fa-exclamation"></i>
    {{/if}}s
  </button>
</template>

<template name="selectGameTypes">
  <div class="select-game-types">
    {{#each options}}
        <div class="each-game-type"><label>
        {{#if shouldBeChecked value}}
          <input id="js-game-type" type="checkbox" value="{{value}}" checked>
          {{value}}
        {{else}}
          <input id="js-game-type" type="checkbox" value="{{value}}">
          {{value}}
        {{/if}}
        </label></div>
    {{/each}}
  </div>
</template>

<template name="back">
  <div class="back">
    <a><span class="app-header-icon ppicon-left-open"></span></a>
  </div>
</template>

<template name="backToList">
  <div class="back-to-list">
    <a href="/">
      <span class="app-header-icon ppicon-left-open"></span>
      <label>Pickups</label>
    </a>
  </div>
</template>

<template name="findingsMap">
  <div class="findings-map">
    <div class="findings-map-wrapper">
      <div class="findings-map-canvas map-canvas"></div>
    </div>
  </div>
</template>

<template name="subscribe">
  <div class="subscribe">
    <div class="subscribe-detail">
      {{detail}}
    </div>
    {{#if SEql 'unauth-subscribe' true}}
      {{> authenticateAndSubscribe}}
    {{else}}
      {{#unless subscribed}}
        {{> subscribeButton}}
      {{/unless}}
    {{/if}}
  </div>
</template>

<template name="authenticateAndSubscribe">
  <div class="authenticate-and-subscribe well">
    <button type="button" class="close" aria-hidden="true">&times;</button>
    <form class="authenticate-and-subscribe" role="form">
      {{#unless currentUser}}
        {{> addInfoOrSignIn action="subscribe"}}
      {{/unless}}
      {{> alerts where="authenticateAndSubscribe"}}

      <!-- Not Template.subscribeButton because we don't want to trigger
           its event handlers-->
      <button type="submit" class="btn subscribe">
        <span class="glyphicon glyphicon-envelope"></span> Subscribe
      </button>
    </form>
  </div>
</template>

<template name="subscribeButton">
  <div class="subscribe-button">
    <button type="button"
            class="btn subscribe">
      <span class="glyphicon glyphicon-envelope"></span>
      Subscribe</button>
  </div>
</template>

<template name="subscribeAfterJoined">
  {{#unless subscribed}}
    {{#if SEql 'joined-game' _id}}
      <div class="subscribe-after-joined well">
        <button type="button" class="close" aria-hidden="true">&times;</button>
        <strong>You joined!</strong>
        <p>Check your email for more info.</p>
        {{> alerts where="subscribe"}}
        <p> Would you like to receive email when new {{type}} games
          are posted near {{placeName}}? </p>
        {{> subscribeButton}}
      </div>
    {{/if}}
  {{/unless}}
</template>

<template name="selectForm">
  {{#if includeLabel}}
    <label for="{{id}}" class="control-label">{{label}}</label>
  {{/if}}
  <div class="{{containerClass}}">
    <span class="ppicon-down-open"></span>
    <select class="form-control {{classes}}" id="{{id}}">
        {{#each options}}
          <option value={{value}} selected={{selected}}>
            {{text}}
          </option>
        {{/each}}
    </select>
  </div>
</template>

<template name="radioForm">
  <div id="{{id}}">
  {{#each options}}
    <input type="radio" id="{{text}}" value="{{value}}" name="{{name}}" checked={{checked}} required>
    <label for="{{text}}">
      <span class="hidden">{{text}}</span>
      <span class="ppicon-{{text}}"></span>
    </label>
  {{/each}}
  </div>
</template>

<template name="devEditableGame">
  <div id="{{action}}Game">
    <div class="app-header">
      <div class="container">
        <div class="close">
          <a href="{{#if editingGame}}/g/{{_id}}{{else}}/{{/if}}">
            <span class="app-header-icon ppicon-cancel"></span>
          </a>
        </div>
        <h1 class="title">{{title}}</h1>
      </div>
    </div>
    <div class="container">
      <div class="game-form">
        <form id="{{action}}GameForm" role="form">
          {{#unless currentUser}}
            {{> addInfoOrSignIn action='add this game'}}
          {{/unless}}
          <div class="form-group">
            {{> radioForm selectType}}
          </div>
          <div class="form-group">
            {{> devSelectWhen}}
          </div>
          <div class="form-group">
            {{> devSelectLocation}}
          </div>
          <div class="form-group">
            {{> editableGameMap}}
          </div>
          <div class="form-group requested">
            {{> selectForm selectPlayersRequested}}
          </div>
          {{#if atLeastOnePlayer}}
            <div class="form-group gamePlayers">
                <p class="form-control-static">
                  {{> whosPlayingEditable}}
                </p>
            </div>
          {{/if}}
          <div class="form-group">
            <label for="gameNote" class="control-label">Details</label>
            <textarea class="form-control game-note" id="gameNote"
                      placeholder="e.g. Donâ€™t forget to bring your equipment and the $5 field fee"
                      maxlength="500">{{note}}</textarea>
          </div>
          {{#unless editingGame}}
            <div class="form-group">
              <p class="form-control-static">
                <strong>Note:</strong> You'll get an email invite
                to forward to your friends.
              </p>
            </div>
          {{/unless}}
          {{#if editingGame}}
            <span class="help-block">
              <strong>Note:</strong>
              Any changes you make will send an update to all players.
            </span>
          {{/if}}
          <!-- <p class="form-control-static"> -->
          <!--   Please let players contact you (your email address -->
          <!--   will not be visible to them; we will forward messages -->
          <!--   to you). Your game will not be visible to others until -->
          <!--   you verify your email address (confirmation sent from -->
          <!--   support@pushpickup.com). Thanks! -->
          <!-- </p> -->
          {{#unless editingGame}}
            <div class="form-group">
              <label>
                <input type="checkbox" class="playing" value="playing" checked>
                <span class="label-add-player">Add me as a player</span>
              </label>
            </div>
          {{/unless}}
          {{> alerts where="editableGame"}}
          <button for="{{action}}GameForm" type="submit"
                  class="btn {{action}}-game">
            {{> submitAndWait}}
          </button>
          {{#if editingGame}}
            <div class="cancel-game text-center"><a class="text-danger remove">Cancel game</a></div>
          {{/if}}
        </form>
      </div>
    </div>
  </div>
</template>

<template name="devSelectWhen">
  {{> selectForm selectDay}}
  {{> selectForm selectTime}}
</template>

<template name="submitAndWait">
  {{#spinnerIfWaiting toComplete=action}}
    {{submit}}
  {{/spinnerIfWaiting}}
</template>

<template name="spinnerIfWaiting">
  {{#if SEql 'waiting-on' toComplete}}
    {{> tinySpinner}}
  {{else}}
    {{> UI.contentBlock}}
  {{/if}}
</template>

<template name="whosPlayingEditable">
  <div class="whos-playing-editable">
    <strong>{{players.length}} playing</strong>
    <ul>
      {{#each userPlayers}}
        <li class="each-player">
          <input type="checkbox" class="hidden" id="{{userId}}"
                 value="{{userId}}">
          <label for="{{userId}}">
            {{name}}
            {{#with friends ../players}}
              + {{numFriends}}
            {{/with}}
            <span class="text-danger">remove</span>
          </label>
        </li>
      {{/each}}
    </ul>
  </div>
</template>

<template name="devSelectLocation">
  <div class="select-location">
    <div class="input-group">
      <input class="form-control location" type="text" placeholder="Add Venue"
             value="{{location.name}}"
             required>
      <span class="input-group-addon">
        <span class="ppicon-location"></span>
      </span>
    </div>
  </div>
</template>

<template name="editableGameMap">
  <div class="editable-game-map {{hidden}}">
    <div class="editable-game-map-wrapper">
      <div class="editable-game-map-canvas map-canvas"></div>
    </div>
  </div>
</template>

<template name="devHelpAndFeedback">
  <form class="dev-help-and-feedback" role="form">
    <p class="form-heading">What kind of feedback are you sending?</p>
    <div class="form-group">
      <div class="radio">
        <label>
          <input type="radio" name="feedback" value="question" checked>
          Question
        </label>
      </div>
      <div class="radio">
        <label>
          <input type="radio" name="feedback" value="suggestion">
          Suggestion
        </label>
      </div>
      <div class="radio">
        <label>
          <input type="radio" name="feedback" value="bug-report">
          Bug report
        </label>
      </div>
      <div class="radio">
        <label>
          <input type="radio" name="feedback" value="love">
          Love
        </label>
      </div>
    </div>
    <div class="form-group">
      <textarea class="form-control" rows="3"></textarea>
    </div>
    <button class="btn help-and-feedback" type="submit">Send</button>
  </form>
</template>

<template name="devSubscriptions">
  <strong class="heading">Get emails for new games</strong>
  <p>You can use search to find locations and game types
    to which you want to subscribe.</p>
  {{#if loading}}
    loading your subscriptions...
  {{else}}
    {{#if hasSubs}}
      <p> You have {{subsCount}} subscriptions.</p>
      <p>
        <a class="text-danger unsubscribe-all">Unsubscribe completely.</a>
      </p>
      <p>
        This page will get fancier soon,
        enabling you to view and edit subscriptions.
      </p>
    {{else}}
      You have no subscriptions.
    {{/if}}
  {{/if}}
</template>